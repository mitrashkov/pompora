@tailwind base;
@tailwind components;
@tailwind utilities;

@font-face {
  font-family: "Perfograma";
  src: url("../fonts/perfograma.regular.otf") format("opentype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@keyframes wsTypingDot {
  0%,
  80%,
  100% {
    transform: translateY(0);
    opacity: 0.35;
  }
  40% {
    transform: translateY(-3px);
    opacity: 0.9;
  }
}

@keyframes wsCaret {
  0%,
  45% {
    opacity: 0.15;
  }
  55%,
  100% {
    opacity: 0.75;
  }
}

:root {
  color-scheme: dark;

  --p-bg: 12 12 12;
  --p-panel: 18 18 18;
  --p-panel2: 24 24 24;
  --p-text: 244 244 245;
  --p-muted: 161 161 170;
  --p-border: 25 25 25;
  --p-accent: 30 144 255;
  --p-accent2: 96 214 170;
  --p-danger: 244 98 98;
}

.xterm,
.xterm-viewport,
.xterm-screen {
  overscroll-behavior: contain;
}

.xterm-viewport {
  scrollbar-gutter: stable;
}

:root[data-theme="light"] {
  color-scheme: light;

  --p-bg: 248 250 252;
  --p-panel: 255 255 255;
  --p-panel2: 241 245 249;
  --p-text: 16 22 32;
  --p-muted: 90 102 120;
  --p-border: 27 27 27;
  --p-accent: 37 99 235;
  --p-accent2: 5 150 105;
  --p-danger: 220 38 38;
}

html,
body,
#root {
  height: 100%;
}

body {
  margin: 0;
  background: rgb(var(--p-bg));
  color: rgb(var(--p-text));
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji",
    "Segoe UI Emoji";
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  overscroll-behavior: none;
}

:focus-visible {
  outline: none;
}

@layer components {
  .ws-card {
    @apply rounded-xl border border-border bg-panel;
  }

  .ws-card-inset {
    @apply rounded-xl border border-border bg-bg;
  }

  .ws-panel2 {
    background: rgb(var(--p-panel2));
  }

  .ws-chip {
    @apply inline-flex items-center gap-1 rounded-md border border-border bg-bg px-2 py-0.5 text-[11px] text-muted;
  }

  .ws-kbd {
    @apply inline-flex items-center rounded-md border border-border bg-panel px-1.5 py-0.5 font-mono text-[10px] text-muted;
  }

  .ws-welcome-title {
    text-shadow: 0 0 22px rgba(30, 144, 255, 0.18);
  }

  .ws-brand-title {
    font-family: "Perfograma", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    letter-spacing: 0.14em;
    text-shadow: 0 0 26px rgba(30, 144, 255, 0.14);
  }

  .ws-welcome-section-title {
    @apply text-[11px] font-semibold uppercase tracking-wider text-muted;
  }

  .ws-welcome-subtitle {
    @apply text-[11px] font-medium text-muted;
  }

  .ws-welcome-row {
    @apply flex w-full items-center justify-between gap-3 rounded-lg border border-border bg-bg/35 px-2.5 py-1.5 text-left text-[13px] text-muted backdrop-blur-sm transition-colors hover:border-accent hover:text-text disabled:opacity-50;
  }

  .ws-btn {
    @apply inline-flex items-center justify-center gap-2 rounded-lg px-3 py-1.5 text-xs font-medium transition-colors disabled:opacity-50;
  }

.ws-change-bar {
  @apply bg-[rgb(var(--p-panel2))] backdrop-blur-sm border border-gray-700 rounded-lg shadow-lg;
}

  .ws-btn-secondary {
    @apply border border-border bg-panel text-text;
  }

  .ws-btn-primary {
    @apply border border-border bg-panel text-text hover:border-accent;
  }

  .ws-btn-danger {
    @apply border border-border bg-bg text-danger hover:bg-panel;
  }

  .ws-input {
    @apply w-full rounded-lg border border-border bg-bg px-3 py-2 text-sm text-text outline-none placeholder:text-muted;
  }

  .ws-icon-btn {
    @apply inline-flex items-center justify-center rounded-md p-1 text-muted hover:bg-bg hover:text-text;
  }

  .ws-toggle {
    @apply relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 focus-visible:ring-offset-bg;
    background-color: hsl(var(--border));
  }

  .ws-toggle input {
    @apply sr-only;
  }

  .ws-toggle input:checked + span {
    @apply translate-x-6;
    background-color: hsl(var(--accent));
  }

  .ws-toggle span {
    @apply inline-block h-4 w-4 transform rounded-full bg-text transition-transform;
  }

  .ws-toggle input:checked + span {
    transform: translateX(1.25rem);
  }

  .ws-select {
    @apply rounded-lg border border-border/60 bg-panel/50 px-3 py-2 text-sm text-text backdrop-blur-sm transition-all hover:border-accent/50 focus-visible:border-accent focus-visible:outline-none;
  }

  .ws-vscode-search {
    @apply w-full rounded-md border border-border bg-bg px-2.5 py-1.5 text-[12px] text-text outline-none placeholder:text-muted hover:border-accent/40 focus-visible:border-accent;
  }

  .ws-vscode-nav-item {
    @apply relative w-full rounded-md px-2 py-1.5 text-left text-[13px] text-muted hover:bg-bg hover:text-text;
  }

  .ws-vscode-nav-item-active {
    @apply bg-bg text-text;
  }

  .ws-vscode-nav-item-active::before {
    content: "";
    position: absolute;
    left: 0;
    top: 6px;
    bottom: 6px;
    width: 2px;
    border-radius: 9999px;
    background: rgb(var(--p-accent));
  }

  .ws-vscode-settings {
    @apply overflow-visible rounded-md border border-border bg-panel;
  }

  .ws-vscode-setting-row {
    @apply grid grid-cols-1 gap-3 border-b border-border px-4 py-3 md:grid-cols-[1fr_300px] md:gap-6;
  }

  .ws-vscode-setting-row:hover {
    background: rgb(var(--p-bg));
  }

  .ws-vscode-setting-row:last-child {
    border-bottom: none;
  }

  .ws-vscode-setting-control {
    @apply flex items-start justify-start md:justify-end;
  }

  .ws-vscode-list-row {
    @apply w-full border-b border-border px-4 py-2 text-left text-[13px] text-muted hover:bg-bg hover:text-text;
  }

  .ws-vscode-list-row:last-child {
    border-bottom: none;
  }

  .ws-vscode-input {
    @apply w-full rounded-md border border-border bg-bg px-2.5 py-1.5 text-[12px] text-text outline-none placeholder:text-muted hover:border-accent/40 focus-visible:border-accent;
  }

  .ws-vscode-select {
    @apply w-[240px] rounded-md border border-border bg-bg px-2.5 py-1.5 pr-8 text-[12px] text-text outline-none hover:border-accent/40 focus-visible:border-accent;
    appearance: none;
  }

  .ws-vscode-btn {
    @apply inline-flex items-center justify-center rounded-md border border-border bg-bg px-3 py-1.5 text-[12px] text-text hover:border-accent;
  }

  .ws-vscode-btn-primary {
    @apply border-accent bg-accent text-bg shadow-sm;
  }

  .ws-vscode-btn-primary:hover {
    @apply border-accent;
    background: rgb(var(--p-accent) / 0.92);
  }

  .ws-vscode-btn-ghost {
    @apply bg-transparent;
  }

  .ws-vscode-menu {
    @apply absolute right-0 top-full z-50 mt-1 w-[280px] overflow-auto rounded-md border border-border bg-panel shadow;
    max-height: min(420px, calc(100vh - 96px));
  }

  .ws-vscode-menu-item {
    @apply w-full px-3 py-2 text-left text-[13px] text-muted hover:bg-bg hover:text-text;
  }

  .ws-vscode-menu-item-active {
    @apply bg-bg text-text;
  }

  .ws-vscode-error {
    @apply rounded-md border border-border bg-bg px-3 py-2 text-sm text-danger;
  }

  .ws-vscode-pre {
    @apply overflow-auto rounded-md border border-border bg-bg p-3 text-xs text-muted;
  }

  .ws-vscode-checkbox {
    @apply inline-flex items-center;
  }

  .ws-vscode-checkbox input {
    @apply h-4 w-4 accent-[rgb(var(--p-accent))];
  }

  .ws-vscode-dropdown-btn {
    @apply inline-flex min-h-[30px] w-[240px] items-center justify-between gap-2 rounded-md border border-border bg-bg px-2.5 py-1.5 text-[12px] text-text outline-none hover:border-accent/40 focus-visible:border-accent;
  }

  .ws-vscode-dropdown-menu {
    @apply absolute right-0 top-full z-50 mt-1 w-[280px] overflow-auto rounded-md border border-border bg-panel shadow;
    max-height: min(420px, calc(100vh - 96px));
  }

  .ws-vscode-dropdown-item {
    @apply w-full px-3 py-2 text-left text-[13px] text-muted hover:bg-bg hover:text-text;
  }

  .ws-vscode-dropdown-item-active {
    @apply bg-bg text-text;
  }

  .ws-vscode-switch {
    @apply relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border border-border bg-bg transition-colors;
  }

  .ws-vscode-switch[data-checked="true"] {
    background: rgb(var(--p-accent) / 0.28);
    border-color: rgb(var(--p-accent) / 0.55);
  }

  .ws-vscode-switch-thumb {
    @apply absolute left-[3px] top-[3px] h-[18px] w-[18px] rounded-full bg-text shadow transition-transform;
    transform: translateX(0);
  }

  .ws-vscode-switch[data-checked="true"] .ws-vscode-switch-thumb {
    transform: translateX(20px);
    background: #fff;
  }

  .ws-settings-input {
    @apply w-full rounded-xl border border-border/60 bg-panel/30 px-3 py-2 text-sm text-text outline-none placeholder:text-muted backdrop-blur-sm transition-colors hover:border-accent/40 focus-visible:border-accent;
  }

  .ws-settings-btn {
    @apply inline-flex items-center gap-2 rounded-xl border border-border/60 bg-panel/30 px-3 py-2 text-sm font-medium text-text backdrop-blur-sm transition-colors hover:border-accent/50 hover:bg-panel/50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent/40 disabled:opacity-50;
  }

  .ws-settings-btn-ghost {
    @apply border-transparent bg-transparent hover:border-border/60 hover:bg-panel/40;
  }

  .ws-settings-nav-item {
    @apply relative flex w-full items-center gap-2 rounded-xl px-3 py-2 text-left text-sm text-muted transition-colors hover:bg-panel/40 hover:text-text;
  }

  .ws-settings-nav-item-active {
    @apply bg-accent/10 text-text;
  }

  .ws-settings-list-item {
    @apply flex w-full items-center gap-2 rounded-xl border border-border/60 bg-panel/20 px-3 py-2 text-left text-sm text-muted transition-colors hover:border-accent/50 hover:bg-panel/50 hover:text-text;
  }

  .ws-dropdown-btn {
    @apply flex w-[240px] max-w-[44vw] items-center justify-between gap-2 rounded-xl border border-border/60 bg-panel/30 px-3 py-2 text-sm text-text backdrop-blur-sm transition-colors hover:border-accent/50 hover:bg-panel/50 focus-visible:outline-none;
  }

  .ws-dropdown-menu {
    @apply absolute right-0 top-full z-50 mt-2 w-[280px] overflow-auto rounded-xl border border-border/60 bg-panel/90 p-1 shadow-xl backdrop-blur;
    max-height: min(420px, calc(100vh - 96px));
  }

  .ws-dropdown-item {
    @apply w-full rounded-lg px-3 py-2 text-left text-sm text-muted transition-colors hover:bg-bg/40 hover:text-text;
  }

  .ws-dropdown-item-active {
    @apply bg-accent/10 text-text;
  }

  .ws-switch {
    @apply relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border border-border/60 bg-panel/40 transition-colors;
  }

  .ws-switch[data-checked="true"] {
    background: rgba(var(--p-accent) / 0.28);
    border-color: rgba(var(--p-accent) / 0.45);
  }

  .ws-switch-thumb {
    @apply absolute left-[3px] top-[3px] h-[18px] w-[18px] rounded-full bg-text shadow transition-transform;
    transform: translateX(0);
  }

  .ws-switch[data-checked="true"] .ws-switch-thumb {
    transform: translateX(20px);
    background: #fff;
  }

  .ws-segment {
    @apply inline-flex items-center overflow-hidden rounded-xl border border-border/60 bg-panel/30;
  }

  .ws-segment-item {
    @apply inline-flex items-center gap-2 px-3 py-2 text-sm text-muted transition-colors hover:bg-panel/50 hover:text-text;
  }

  .ws-segment-item-active {
    @apply bg-accent/10 text-text;
  }

  .ws-msg {
    @apply rounded-xl px-3 py-2 text-sm text-text;
  }

  .ws-msg-user {
    background: rgb(var(--p-panel2));
  }

  .ws-msg-assistant {
    background: rgb(var(--p-panel));
  }

  .ws-msg-anim {
    animation: wsFadeUp 160ms ease-out;
  }

  .ws-thinking-dots {
    display: inline-flex;
    gap: 3px;
    margin-left: 6px;
    vertical-align: middle;
  }

  .ws-thinking-dots span {
    width: 3px;
    height: 3px;
    border-radius: 9999px;
    background: rgb(var(--p-muted));
    opacity: 0.25;
    animation: wsDot 900ms infinite;
  }

  .ws-thinking-dots span:nth-child(2) {
    animation-delay: 150ms;
  }

  .ws-thinking-dots span:nth-child(3) {
    animation-delay: 300ms;
  }

  .ws-thinking-dots span:nth-child(4) {
    animation-delay: 450ms;
  }

  .ws-thinking-dots span:nth-child(5) {
    animation-delay: 600ms;
  }

  .ws-thinking-dots span:nth-child(6) {
    animation-delay: 750ms;
  }

  .ws-thinking {
    @apply w-fit text-xs text-muted;
  }

  .ws-msg-meta {
    @apply ws-chip w-fit;
  }

  .ws-diff {
    @apply ws-card-inset overflow-hidden;
  }

  .ws-diff-header {
    @apply flex items-center justify-between gap-2 border-b border-border px-3 py-2;
  }

  .ws-diff-body {
    @apply max-h-64 overflow-auto font-mono text-[11px] leading-5;
  }

  .ws-diff-row {
    @apply grid grid-cols-[52px_52px_1fr] gap-2 px-3 whitespace-pre;
  }

  .ws-step-pill {
    @apply inline-flex items-center gap-2 rounded-full border border-border bg-bg px-2 py-1 text-[11px] text-muted;
    animation: wsFadeUp 140ms ease-out;
  }

  .ws-step-dot {
    @apply h-2 w-2 shrink-0 rounded-full bg-accent;
    box-shadow: 0 0 0 6px rgba(112, 163, 255, 0.08);
  }

  .ws-agent-step {
    @apply inline-flex max-w-[92%] items-center gap-2 rounded-lg border border-border bg-bg px-3 py-2 text-[12px] text-muted;
    animation: wsFadeUp 160ms ease-out;
  }

  .ws-agent-dot {
    @apply h-2 w-2 shrink-0 rounded-full bg-accent;
    box-shadow: 0 0 0 8px rgba(112, 163, 255, 0.08);
  }

  .ws-caret {
    display: inline-block;
    width: 6px;
    height: 1.05em;
    margin-left: 2px;
    border-radius: 2px;
    background: rgb(var(--p-accent));
    opacity: 0.65;
    animation: wsCaret 900ms infinite;
    vertical-align: text-bottom;
  }

  .ws-typing {
    @apply inline-flex items-center gap-2;
    animation: wsFadeUp 160ms ease-out;
  }

  .ws-typing-bubble {
    @apply rounded-full border border-border bg-panel px-3 py-2;
    box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.08);
  }

  .ws-typing-label {
    @apply text-[11px] text-muted;
  }

  .ws-typing-dots {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    height: 10px;
  }

  .ws-typing-dots span {
    width: 6px;
    height: 6px;
    border-radius: 9999px;
    background: rgb(var(--p-muted));
    opacity: 0.35;
    animation: wsTypingDot 900ms infinite;
  }

  .ws-typing-dots span:nth-child(2) {
    animation-delay: 120ms;
  }

  .ws-typing-dots span:nth-child(3) {
    animation-delay: 240ms;
  }

  .ws-log-panel {
    @apply w-full max-w-[92%] rounded-xl border border-border bg-panel;
    animation: wsFadeUp 160ms ease-out;
  }

  .ws-log-panel-header {
    @apply flex items-center justify-between gap-2 px-2.5 py-2;
  }

  .ws-log-panel-title {
    @apply inline-flex min-w-0 items-center gap-2 rounded-lg px-2 py-1 text-left text-[12px] text-muted hover:bg-bg hover:text-text;
  }

  .ws-log-pill {
    @apply inline-flex items-center rounded-full border border-border bg-bg px-2 py-0.5 text-[11px] text-muted;
  }

  .ws-log-count {
    @apply inline-flex items-center justify-center rounded-md border border-border bg-bg px-1.5 py-0.5 text-[10px] text-muted;
  }

  .ws-log-chevron {
    @apply h-4 w-4 shrink-0 text-muted transition-transform duration-200;
  }

  .ws-log-actions {
    @apply shrink-0;
  }

  .ws-log-panel-body {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    transition: max-height 260ms ease, opacity 200ms ease;
  }

  .ws-log-panel-body-open {
    max-height: 420px;
    opacity: 1;
  }

  .ws-log-latest {
    @apply border-t border-border/60 px-2.5 py-2;
  }

  .ws-log-list {
    @apply px-2.5 py-2;
  }

  .ws-log-item {
    @apply flex items-start gap-2 py-1 text-[12px] text-muted;
  }

  .ws-log-item-latest {
    @apply text-text;
  }

  .ws-log-dot {
    width: 8px;
    height: 8px;
    border-radius: 9999px;
    background: rgb(var(--p-accent));
    opacity: 0.85;
    box-shadow: 0 0 0 10px rgba(112, 163, 255, 0.08);
    margin-top: 4px;
    flex: 0 0 auto;
  }

  .ws-agent-panel {
    @apply overflow-hidden rounded-lg border border-border bg-bg;
  }

  .ws-agent-panel-h {
    @apply transition-colors hover:bg-panel;
  }

  .ws-agent-panel-b {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    transition: max-height 260ms ease, opacity 200ms ease;
  }

  .ws-agent-panel-b-open {
    max-height: 520px;
    opacity: 1;
  }

  .ws-terminal-log {
    @apply max-h-56 overflow-auto rounded-md border border-border bg-panel p-2 font-mono text-[11px] text-muted;
  }

  .ws-log-entry {
    @apply overflow-hidden rounded-xl border border-border bg-panel;
    animation: wsFadeUp 160ms ease-out;
  }

  .ws-log-group {
    @apply overflow-hidden rounded-2xl border border-border bg-panel;
    animation: wsFadeUp 160ms ease-out;
  }

  .ws-log-group-h {
    @apply flex w-full items-center justify-between gap-3 px-3 py-2 text-left hover:bg-bg;
  }

  .ws-log-group-title {
    @apply truncate text-[13px] font-medium text-text;
  }

  .ws-log-group-sub {
    @apply mt-0.5 text-[11px] text-muted;
  }

  .ws-log-group-b {
    @apply border-t border-border/60 px-3 py-3;
  }

  .ws-log-entry-h {
    @apply flex w-full items-center justify-between gap-3 px-3 py-2 text-left hover:bg-bg;
  }

  .ws-log-entry-title {
    @apply truncate text-[13px] text-text;
  }

  .ws-log-entry-sub {
    @apply mt-0.5 text-[11px] text-muted;
  }

  .ws-log-status {
    @apply inline-flex items-center rounded-full border px-2 py-0.5 text-[11px];
  }

  .ws-log-entry-b {
    @apply border-t border-border/60 px-3 py-2;
  }
}

@keyframes wsFadeUp {
  from {
    transform: translateY(4px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

@keyframes wsDot {
  0%,
  80%,
  100% {
    opacity: 0.25;
    transform: translateY(0);
  }
  40% {
    opacity: 0.9;
    transform: translateY(-1px);
  }
}
